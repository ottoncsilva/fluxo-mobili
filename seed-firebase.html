<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Seed Firebase - FluxoERP</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: #e2e8f0; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .container { background: #1e293b; border-radius: 16px; padding: 40px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        h1 { font-size: 24px; margin-bottom: 8px; color: #60a5fa; }
        p.sub { color: #94a3b8; margin-bottom: 24px; font-size: 14px; }
        label { display: block; font-size: 13px; color: #94a3b8; margin-bottom: 4px; margin-top: 16px; }
        input { width: 100%; padding: 10px 14px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: #e2e8f0; font-size: 14px; outline: none; }
        input:focus { border-color: #60a5fa; }
        .divider { height: 1px; background: #334155; margin: 24px 0; }
        button { width: 100%; padding: 14px; border-radius: 10px; border: none; background: #2563eb; color: white; font-size: 16px; font-weight: 700; cursor: pointer; margin-top: 24px; }
        button:hover { background: #1d4ed8; }
        button:disabled { background: #334155; cursor: not-allowed; }
        .status { margin-top: 16px; padding: 12px; border-radius: 8px; font-size: 14px; display: none; }
        .status.ok { display: block; background: #065f46; color: #6ee7b7; }
        .status.err { display: block; background: #7f1d1d; color: #fca5a5; }
        .status.loading { display: block; background: #1e3a5f; color: #93c5fd; }
        small { color: #64748b; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå± Seed do Firebase</h1>
        <p class="sub">Cole as credenciais do Firebase e clique no bot√£o. Ele vai criar a loja e o usu√°rio admin automaticamente.</p>

        <h3 style="color: #f59e0b; font-size: 14px;">üîë Credenciais Firebase</h3>

        <label>API Key</label>
        <input type="text" id="apiKey" placeholder="AIzaSy...">

        <label>Auth Domain</label>
        <input type="text" id="authDomain" placeholder="meu-projeto.firebaseapp.com">

        <label>Project ID</label>
        <input type="text" id="projectId" placeholder="meu-projeto-12345">

        <label>Storage Bucket</label>
        <input type="text" id="storageBucket" placeholder="meu-projeto.firebasestorage.app">

        <label>Messaging Sender ID</label>
        <input type="text" id="messagingSenderId" placeholder="123456789">

        <label>App ID</label>
        <input type="text" id="appId" placeholder="1:123456789:web:abcdef">

        <div class="divider"></div>

        <h3 style="color: #34d399; font-size: 14px;">üè™ Dados da sua Loja</h3>

        <label>Nome da Loja</label>
        <input type="text" id="storeName" placeholder="Ex: FabriMoveis" value="FabriMoveis">

        <label>Slug de Login <small>(sem espa√ßos, sem acentos)</small></label>
        <input type="text" id="storeSlug" placeholder="Ex: fabri" value="fabri">

        <div class="divider"></div>

        <h3 style="color: #a78bfa; font-size: 14px;">üë§ Usu√°rio Administrador</h3>

        <label>Nome completo</label>
        <input type="text" id="adminName" placeholder="Ex: Otton Silva" value="Otton Silva">

        <label>Username de login</label>
        <input type="text" id="adminUsername" placeholder="Ex: ottonsilva" value="ottonsilva">

        <label>Senha</label>
        <input type="text" id="adminPassword" placeholder="Ex: 123456" value="123456">

        <button id="seedBtn" onclick="seedFirebase()">üöÄ Criar Loja e Admin no Firebase</button>

        <div id="status" class="status"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        window.seedFirebase = async function() {
            const btn = document.getElementById('seedBtn');
            const status = document.getElementById('status');

            const apiKey = document.getElementById('apiKey').value.trim();
            const authDomain = document.getElementById('authDomain').value.trim();
            const projectId = document.getElementById('projectId').value.trim();
            const storageBucket = document.getElementById('storageBucket').value.trim();
            const messagingSenderId = document.getElementById('messagingSenderId').value.trim();
            const appId = document.getElementById('appId').value.trim();

            const storeName = document.getElementById('storeName').value.trim();
            const storeSlug = document.getElementById('storeSlug').value.trim();
            const adminName = document.getElementById('adminName').value.trim();
            const adminUsername = document.getElementById('adminUsername').value.trim();
            const adminPassword = document.getElementById('adminPassword').value.trim();

            if (!apiKey || !projectId || !storeName || !storeSlug || !adminName || !adminUsername || !adminPassword) {
                status.className = 'status err';
                status.textContent = '‚ùå Preencha todos os campos!';
                return;
            }

            btn.disabled = true;
            status.className = 'status loading';
            status.textContent = '‚è≥ Conectando ao Firebase...';

            try {
                const app = initializeApp({
                    apiKey, authDomain, projectId, storageBucket, messagingSenderId, appId
                });
                const db = getFirestore(app);

                status.textContent = '‚è≥ Criando loja...';

                const storeId = 'store-principal';
                await setDoc(doc(db, "stores", storeId), {
                    id: storeId,
                    name: storeName,
                    slug: storeSlug,
                    createdAt: new Date().toISOString(),
                    status: 'active',
                    settings: {
                        name: storeName,
                        cnpj: '',
                        corporateName: storeName,
                        address: '',
                        phone: '',
                        socialMedia: ''
                    }
                });

                status.textContent = '‚è≥ Criando usu√°rio admin...';

                const userId = 'u-admin-1';
                await setDoc(doc(db, "users", userId), {
                    id: userId,
                    storeId: storeId,
                    name: adminName,
                    username: adminUsername,
                    password: adminPassword,
                    role: 'Admin',
                    isSystemUser: true,
                    contractType: 'PJ'
                });

                status.className = 'status ok';
                status.innerHTML = `
                    ‚úÖ <strong>Pronto!</strong> Loja e admin criados com sucesso!<br><br>
                    üìå Para logar no app use:<br>
                    <strong>Slug:</strong> ${storeSlug}<br>
                    <strong>Usu√°rio:</strong> ${adminUsername}<br>
                    <strong>Senha:</strong> ${adminPassword}
                `;

            } catch (err) {
                status.className = 'status err';
                status.textContent = '‚ùå Erro: ' + err.message;
                console.error(err);
            }

            btn.disabled = false;
        }
    </script>
</body>
</html>
